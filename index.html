<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tango ‚Äî Production Dashboard</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Tango">
<link rel="apple-touch-icon" href="app-icon-192.png">
<meta name="theme-color" content="#1A1A1A">

<link rel="stylesheet" href="tango-system.css">
<style>
/* ================================================================
   DASHBOARD PAGE ‚Äî Page-specific styles only
   Shared foundation (fonts, tokens, reset, noise, nav base,
   footer, buttons) lives in tango-system.css
   ================================================================ */


/* ============================================================ */
/* DASHBOARD LAYOUT                                              */
/* ============================================================ */
.dashboard {
  max-width: var(--max-width);
  margin: 0 auto;
  padding: 0 24px 80px;
}

/* Hero removed ‚Äî mobile-first, no big title */


/* ============================================================ */
/* STAT CARDS ROW                                                */
/* ============================================================ */
.stat-row {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 20px;
  margin-bottom: 48px;
}
.stat-card {
  background: var(--bg-surface);
  border-radius: 20px;
  padding: 24px;
  position: relative;
  box-shadow: 0 0 60px rgba(0,0,0,0.20);
  overflow: hidden;
}
/* Noise on stat cards ‚Äî lighter than body (0.56) so cells feel clean */
.stat-card::before {
  content: '';
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 0;
  opacity: 0.25;
  mix-blend-mode: multiply;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
  background-repeat: repeat;
  background-size: 512px 512px;
  border-radius: 20px;
}
.stat-card > * {
  position: relative;
  z-index: 1;
}
.stat-card__label {
  font-family: var(--font-body);
  font-size: 12px;
  font-weight: 500;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 0.15em;
  margin-bottom: 8px;
}
.stat-card__value {
  font-family: 'Beast', var(--font-headline);
  font-size: 36px;
  font-weight: 400;
  color: var(--text);
  letter-spacing: -0.02em;
  line-height: 1;
  margin-bottom: 4px;
}
.stat-card__delta {
  font-family: var(--font-body);
  font-size: 12px;
  font-weight: 500;
}
.stat-card__delta--up {
  color: var(--green);
}
.stat-card__delta--down {
  color: #CC0000;
}
.stat-card__delta--flat {
  color: var(--muted);
}

/* Highlighted stat card */
.stat-card--highlight {
  background: var(--yellow);
}


/* ============================================================ */
/* SECTION HEADERS                                               */
/* ============================================================ */
.section-header {
  display: flex;
  align-items: baseline;
  justify-content: space-between;
  margin-bottom: 20px;
  padding-bottom: 12px;
}
.section-header__title {
  font-family: var(--font-headline);
  font-size: 22px;
  font-weight: 700;
  color: var(--text);
  text-transform: capitalize;
}
.section-header__badge {
  font-family: var(--font-body);
  font-size: 12px;
  font-weight: 500;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 0.1em;
}


/* ============================================================ */
/* DATA TABLES                                                   */
/* ============================================================ */
.data-table-wrap {
  background: var(--bg-surface);
  border-radius: 20px;
  box-shadow: 0 0 60px rgba(0,0,0,0.20);
  overflow: hidden;
  margin-bottom: 48px;
  position: relative;
}
/* Noise on table containers ‚Äî lighter than body */
.data-table-wrap::before {
  content: '';
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 0;
  opacity: 0.25;
  mix-blend-mode: multiply;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
  background-repeat: repeat;
  background-size: 512px 512px;
  border-radius: 20px;
}
.data-table-wrap > * {
  position: relative;
  z-index: 1;
}
.data-table {
  width: 100%;
  border-collapse: collapse;
  font-family: var(--font-body);
  font-size: 13px;
}
.data-table thead th {
  font-family: var(--font-body);
  font-size: 11px;
  font-weight: 500;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 0.12em;
  text-align: left;
  padding: 16px 20px 12px;
}
.data-table thead th:last-child,
.data-table tbody td:last-child {
  text-align: right;
}
.data-table tbody td {
  padding: 14px 20px;
  border-bottom: 1px dashed rgba(0,0,0,0.12);
  vertical-align: middle;
  color: var(--text);
  font-weight: 400;
}
.data-table tbody tr:last-child td {
  border-bottom: none;
}
.data-table tbody tr:hover {
  background: rgba(0,0,0,0.02);
}

/* Flavor dot in table rows */
.flavor-dot {
  display: inline-block;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  border: 1px solid var(--text);
  margin-right: 8px;
  vertical-align: middle;
}

/* Bold product name column */
.data-table .col-name {
  font-family: var(--font-headline);
  font-size: 14px;
  font-weight: 700;
  text-transform: capitalize;
}

/* Numeric columns */
.data-table .col-num {
  font-variant-numeric: tabular-nums;
  font-weight: 500;
}

/* Status pill */
.status-pill {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-family: var(--font-body);
  font-size: 11px;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  padding: 4px 14px;
  border-radius: 9999px;
  border: 1px solid var(--text);
  line-height: 1;
}
.status-pill--green {
  background: var(--green);
  color: var(--text);
}
.status-pill--yellow {
  background: var(--yellow);
  color: var(--text);
}
.status-pill--orange {
  background: var(--orange);
  color: var(--text);
}
.status-pill--red {
  background: #CC0000;
  color: var(--white);
}
.status-pill--muted {
  background: rgba(0,0,0,0.06);
  color: var(--muted);
}


/* Copy list button ‚Äî smaller inline variant of .btn */
#copy-deep-btn { font-size: 13px; padding: 8px 20px; }
#copy-deep-btn::before { font-size: 13px; padding: 8px 20px; }

/* ============================================================ */
/* TWO-COLUMN GRID LAYOUT                                        */
/* ============================================================ */
.grid-2col {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 24px;
  margin-bottom: 48px;
}


/* ============================================================ */
/* CHANNEL PERFORMANCE BARS                                      */
/* ============================================================ */
.channel-card {
  background: var(--bg-surface);
  border-radius: 20px;
  box-shadow: 0 0 60px rgba(0,0,0,0.20);
  padding: 24px;
  position: relative;
  overflow: hidden;
}
.channel-card::before {
  content: '';
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 0;
  opacity: 0.25;
  mix-blend-mode: multiply;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
  background-repeat: repeat;
  background-size: 512px 512px;
  border-radius: 20px;
}
.channel-card > * {
  position: relative;
  z-index: 1;
}

.channel-bar-row {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 16px;
}
.channel-bar-row:last-child {
  margin-bottom: 0;
}
.channel-bar__label {
  font-family: var(--font-body);
  font-size: 12px;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--text);
  width: 100px;
  flex-shrink: 0;
}
.channel-bar__track {
  flex: 1;
  height: 20px;
  background: rgba(0,0,0,0.06);
  border-radius: 9999px;
  border: 1px solid var(--text);
  overflow: hidden;
  position: relative;
}
.channel-bar__fill {
  height: 100%;
  border-radius: 9999px;
  transition: width 0.6s ease;
}
.channel-bar__fill--green { background: var(--green); }
.channel-bar__fill--yellow { background: var(--yellow); }
.channel-bar__fill--orange { background: var(--orange); }
.channel-bar__value {
  font-family: var(--font-body);
  font-size: 12px;
  font-weight: 700;
  color: var(--text);
  width: 60px;
  text-align: right;
  flex-shrink: 0;
}


/* ============================================================ */
/* GOAL PROGRESS CARD                                            */
/* ============================================================ */
.goal-card {
  background: var(--green);
  border-radius: 20px;
  padding: 32px;
  position: relative;
  overflow: hidden;
}
.goal-card::before {
  content: '';
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 0;
  opacity: 0.35;
  mix-blend-mode: multiply;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
  background-repeat: repeat;
  background-size: 512px 512px;
  border-radius: 20px;
}
.goal-card > * {
  position: relative;
  z-index: 1;
}
.goal-card__label {
  font-family: var(--font-body);
  font-size: 12px;
  font-weight: 500;
  color: var(--text);
  text-transform: uppercase;
  letter-spacing: 0.15em;
  margin-bottom: 8px;
}
.goal-card__amount {
  font-family: 'Beast', var(--font-headline);
  font-size: clamp(36px, 4vw, 56px);
  font-weight: 400;
  color: var(--text);
  letter-spacing: -0.02em;
  line-height: 1;
  margin-bottom: 4px;
}
.goal-card__target {
  font-family: var(--font-body);
  font-size: 14px;
  font-weight: 400;
  color: var(--text);
  margin-bottom: 16px;
}
.goal-card__bar-track {
  width: 100%;
  height: 14px;
  background: rgba(0,0,0,0.12);
  border-radius: 9999px;
  border: 1px solid var(--text);
  overflow: hidden;
}
.goal-card__bar-fill {
  height: 100%;
  background: var(--yellow);
  border-radius: 9999px;
}


/* ============================================================ */
/* ORDER CARDS (legacy)                                          */
/* ============================================================ */
.order-card {
  background: var(--bg-surface);
  border-radius: 20px;
  box-shadow: 0 0 60px rgba(0,0,0,0.20);
  padding: 20px;
  margin-bottom: 20px;
  position: relative;
  overflow: hidden;
}
.order-card::before {
  content: '';
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 0;
  opacity: 0.25;
  mix-blend-mode: multiply;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
  background-repeat: repeat;
  background-size: 512px 512px;
  border-radius: 20px;
}
.order-card > * {
  position: relative;
  z-index: 1;
}
.order-card__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 12px;
  flex-wrap: wrap;
  gap: 8px;
}
.order-card__title {
  font-family: var(--font-headline);
  font-size: 16px;
  font-weight: 700;
  text-transform: capitalize;
  color: var(--text);
}
.order-card__meta {
  font-family: var(--font-body);
  font-size: 12px;
  color: var(--muted);
  letter-spacing: 0.05em;
}
.order-card__note {
  font-family: var(--font-body);
  font-size: 12px;
  font-style: italic;
  color: var(--muted);
  margin-bottom: 12px;
}

/* ============================================================ */
/* üì¶ ORDERS PIPELINE ‚Äî Drag & Drop Kanban                      */
/* ============================================================ */
.orders-pipeline {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 16px;
  margin-bottom: 48px;
}
@media (max-width: 900px) {
  .orders-pipeline {
    grid-template-columns: repeat(2, 1fr);
  }
}
@media (max-width: 480px) {
  .orders-pipeline {
    grid-template-columns: 1fr;
  }
}

.pipeline-col {
  min-height: 120px;
}
.pipeline-col__header {
  font-family: var(--font-body);
  font-size: 11px;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.12em;
  color: var(--muted);
  padding-bottom: 10px;
  margin-bottom: 12px;
  border-bottom: 2px solid var(--text);
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.pipeline-col__count {
  font-variant-numeric: tabular-nums;
  background: rgba(0,0,0,0.06);
  border-radius: 6px;
  padding: 2px 8px;
  font-size: 10px;
}
.pipeline-col__drop {
  min-height: 80px;
  border-radius: 12px;
  transition: background 0.15s;
}
.pipeline-col__drop.drag-over {
  background: rgba(255,149,0,0.08);
  outline: 2px dashed var(--orange);
  outline-offset: -2px;
}

/* Pipeline order card */
.pipe-card {
  background: var(--bg-surface);
  border-radius: 14px;
  box-shadow: 0 2px 20px rgba(0,0,0,0.12);
  padding: 14px 16px;
  margin-bottom: 10px;
  cursor: grab;
  position: relative;
  overflow: hidden;
  border: 1px solid rgba(0,0,0,0.08);
  transition: transform 0.15s, box-shadow 0.15s;
}
.pipe-card:active {
  cursor: grabbing;
  transform: scale(1.02);
  box-shadow: 0 8px 30px rgba(0,0,0,0.20);
}
.pipe-card.dragging {
  opacity: 0.4;
}
.pipe-card::before {
  content: '';
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 0;
  opacity: 0.2;
  mix-blend-mode: multiply;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
  background-repeat: repeat;
  background-size: 512px 512px;
  border-radius: 14px;
}
.pipe-card > * {
  position: relative;
  z-index: 1;
}
.pipe-card__channel {
  font-family: var(--font-body);
  font-size: 10px;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: var(--muted);
  margin-bottom: 4px;
}
.pipe-card__title {
  font-family: var(--font-headline);
  font-size: 14px;
  font-weight: 700;
  color: var(--text);
  margin-bottom: 4px;
}
.pipe-card__value {
  font-family: var(--font-body);
  font-size: 13px;
  font-weight: 700;
  color: var(--text);
  margin-bottom: 2px;
}
.pipe-card__date {
  font-family: var(--font-body);
  font-size: 11px;
  color: var(--muted);
  margin-bottom: 8px;
}
.pipe-card__docs {
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
}
.pipe-card__doc {
  font-family: var(--font-body);
  font-size: 10px;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  padding: 3px 10px;
  border-radius: 6px;
  border: 1px solid var(--text);
  color: var(--text);
  text-decoration: none;
  transition: background 0.15s, color 0.15s;
  cursor: pointer;
}
.pipe-card__doc:hover {
  background: var(--text);
  color: var(--bg);
}
.pipe-card__doc--missing {
  border-color: rgba(0,0,0,0.15);
  color: var(--muted);
  border-style: dashed;
}
.pipe-card__doc--missing:hover {
  background: rgba(0,0,0,0.04);
  color: var(--muted);
}

/* Process flow */
.process-flow {
  font-family: var(--font-body);
  font-size: 13px;
  font-weight: 500;
  color: var(--text);
  background: rgba(0,0,0,0.04);
  border: 1px solid var(--text);
  border-radius: 12px;
  padding: 12px 16px;
  margin-bottom: 24px;
  text-align: center;
  letter-spacing: 0.02em;
}

/* Compact data table for mobile */
.data-table--compact {
  font-size: 12px;
}
.data-table--compact thead th {
  padding: 12px 14px 10px;
  font-size: 10px;
}
.data-table--compact tbody td {
  padding: 10px 14px;
}

/* ============================================================ */
/* üî¢ INVENTORY COUNTER ‚Äî Editable quantity list                 */
/* ============================================================ */
.inv-counter {
  margin-bottom: 48px;
}
.inv-counter__group-title {
  font-family: var(--font-headline);
  font-size: 14px;
  font-weight: 700;
  text-transform: capitalize;
  color: var(--muted);
  letter-spacing: 0.1em;
  padding: 16px 0 8px;
}
.inv-counter__row {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 0;
  border-bottom: 1px dashed rgba(0,0,0,0.1);
}
.inv-counter__row:last-child {
  border-bottom: none;
}
.inv-counter__label {
  flex: 1;
  font-family: var(--font-body);
  font-size: 14px;
  font-weight: 500;
  color: var(--text);
  min-width: 0;
}
.inv-counter__controls {
  display: flex;
  align-items: center;
  gap: 0;
  flex-shrink: 0;
}
.inv-counter__btn {
  width: 44px;
  height: 44px;
  border: 1px solid var(--text);
  background: var(--bg-surface);
  font-family: var(--font-body);
  font-size: 20px;
  font-weight: 700;
  color: var(--text);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  -webkit-tap-highlight-color: transparent;
  user-select: none;
  transition: background 0.15s;
}
.inv-counter__btn:first-child {
  border-radius: 12px 0 0 12px;
}
.inv-counter__btn:last-child {
  border-radius: 0 12px 12px 0;
}
.inv-counter__btn:active {
  background: var(--text);
  color: var(--bg);
}
.inv-counter__value {
  width: 64px;
  height: 44px;
  border-top: 1px solid var(--text);
  border-bottom: 1px solid var(--text);
  border-left: none;
  border-right: none;
  background: var(--bg-surface);
  font-family: var(--font-body);
  font-size: 16px;
  font-weight: 700;
  color: var(--text);
  text-align: center;
  -moz-appearance: textfield;
  appearance: textfield;
}
.inv-counter__value::-webkit-inner-spin-button,
.inv-counter__value::-webkit-outer-spin-button {
  -webkit-appearance: none;
  margin: 0;
}
.inv-counter__value:focus {
  outline: 2px solid var(--orange);
  outline-offset: -2px;
  z-index: 1;
  position: relative;
}

/* Multi-column grid for flavor items */
.inv-counter__grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 8px 12px;
}
@media (max-width: 600px) {
  .inv-counter__grid {
    grid-template-columns: repeat(2, 1fr);
  }
}
.inv-counter__grid .inv-counter__row {
  flex-direction: column;
  align-items: stretch;
  gap: 6px;
  padding: 8px 0;
}
.inv-counter__grid .inv-counter__label {
  font-size: 12px;
  text-align: center;
}
.inv-counter__grid .inv-counter__controls {
  justify-content: center;
}
.inv-counter__grid .inv-counter__value {
  width: 52px;
}

/* Counter card wrapper */
.inv-counter__card {
  background: var(--bg-surface);
  border-radius: 20px;
  box-shadow: 0 0 60px rgba(0,0,0,0.20);
  padding: 20px 24px;
  position: relative;
  overflow: hidden;
}
.inv-counter__card::before {
  content: '';
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 0;
  opacity: 0.25;
  mix-blend-mode: multiply;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
  background-repeat: repeat;
  background-size: 512px 512px;
  border-radius: 20px;
}
.inv-counter__card > * {
  position: relative;
  z-index: 1;
}

/* Timestamp */
.inv-counter__timestamp {
  font-family: var(--font-body);
  font-size: 11px;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 0.1em;
  text-align: right;
  padding-top: 12px;
}

/* ============================================================ */
/* RESPONSIVE                                                    */
/* ============================================================ */
@media (max-width: 900px) {
  .stat-row {
    grid-template-columns: repeat(2, 1fr);
  }
  .grid-2col {
    grid-template-columns: 1fr;
  }
}
@media (max-width: 480px) {
  .stat-row {
    grid-template-columns: 1fr;
  }
}

/* ============================================================ */
/* FLAVOR GRID TABLES ‚Äî 6-column flavor layout                   */
/* ============================================================ */
.data-table--flavor-grid {
  table-layout: fixed;
}
.data-table--flavor-grid th:first-child {
  width: 120px;
}
.data-table--flavor-grid th:not(:first-child) {
  text-align: center;
  font-weight: 700;
  font-size: 13px;
  letter-spacing: 0.03em;
}
.data-table--flavor-grid td:not(:first-child) {
  text-align: center;
  font-family: var(--font-body);
  font-variant-numeric: tabular-nums;
}
.data-table--flavor-grid td.cell-ok {
  color: var(--green);
  font-weight: 700;
}
.data-table--flavor-grid td.cell-warn {
  color: var(--yellow);
  font-weight: 700;
}
.data-table--flavor-grid td.cell-bad {
  color: #CC0000;
  font-weight: 700;
}
.data-table--flavor-grid td.cell-zero {
  color: var(--muted);
  opacity: 0.4;
}
.data-table--flavor-grid tr.row-total td {
  font-weight: 700;
  border-top: 2px solid var(--text);
  padding-top: 10px;
}
.data-table--flavor-grid tr.row-total td:first-child {
  font-family: var(--font-headline);
  text-transform: uppercase;
  font-size: 11px;
  letter-spacing: 0.1em;
}

/* ============================================================ */
/* NEXT STEPS CARD                                               */
/* ============================================================ */
.next-steps-card {
  background: var(--bg-surface);
  border-radius: 20px;
  box-shadow: 0 0 60px rgba(0,0,0,0.20);
  padding: 24px;
  position: relative;
  overflow: hidden;
}
.next-steps-card::before {
  content: '';
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 0;
  opacity: 0.25;
  mix-blend-mode: multiply;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
  background-repeat: repeat;
  background-size: 512px 512px;
  border-radius: 20px;
}
.next-steps-card > * {
  position: relative;
  z-index: 1;
}
.next-step-item {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  padding: 10px 0;
  border-bottom: 1px solid rgba(0,0,0,0.06);
}
.next-step-item:last-child {
  border-bottom: none;
}
.next-step-num {
  font-family: 'Beast', var(--font-headline);
  font-size: 20px;
  color: var(--orange);
  line-height: 1.2;
  flex-shrink: 0;
  width: 24px;
}
.next-step-text {
  font-family: var(--font-body);
  font-size: 14px;
  color: var(--text);
  line-height: 1.5;
}
.next-step-text strong {
  color: var(--orange);
}

/* ============================================================ */
/* EDITABLE CELLS ‚Äî inline inputs for Supabase-backed tables     */
/* ============================================================ */
.edit-input {
  background: transparent;
  border: none;
  border-bottom: 1px dashed rgba(0,0,0,0.15);
  text-align: center;
  font-weight: 700;
  width: 100%;
  font-family: var(--font-body);
  font-size: 13px;
  color: var(--text);
  padding: 2px 0;
  font-variant-numeric: tabular-nums;
  -moz-appearance: textfield;
}
.edit-input::-webkit-inner-spin-button,
.edit-input::-webkit-outer-spin-button {
  -webkit-appearance: none;
  margin: 0;
}
.edit-input:focus {
  outline: none;
  border-bottom: 2px solid var(--orange);
}
.edit-input--text {
  text-align: left;
  font-weight: 400;
  font-size: 12px;
}

/* Tappable status pills (cycle on click) */
.status-pill--tap {
  cursor: pointer;
  user-select: none;
  transition: transform 0.1s;
}
.status-pill--tap:active {
  transform: scale(0.92);
}

/* ============================================================ */
/* PRODUCTION BRAIN ‚Äî collapsible details section                */
/* ============================================================ */
.brain-details {
  margin-bottom: 32px;
}
.brain-details summary {
  cursor: pointer;
  list-style: none;
  display: flex;
  align-items: center;
  gap: 8px;
}
.brain-details summary::-webkit-details-marker { display: none; }
.brain-details summary::before {
  content: '‚ñ∏';
  font-size: 14px;
  color: var(--muted);
  transition: transform 0.2s;
}
.brain-details[open] summary::before {
  transform: rotate(90deg);
}
.brain-subsection {
  margin-top: 24px;
}
.brain-subsection__title {
  font-family: var(--font-headline);
  font-size: 13px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--muted);
  margin-bottom: 12px;
}
.brain-ref-card {
  background: var(--bg-surface);
  border-radius: 16px;
  padding: 20px;
  box-shadow: 0 0 40px rgba(0,0,0,0.10);
  font-family: var(--font-body);
  font-size: 13px;
  line-height: 1.6;
  color: var(--text);
}
.brain-ref-card strong {
  color: var(--orange);
}
</style>
</head>
<body>

<!-- DASHBOARD HEADER -->
<div style="max-width:var(--max-width);margin:0 auto;padding:24px 24px 0;display:flex;align-items:center;gap:16px;">
  <img src="! LOGO.png" alt="Tango" style="height:40px;">
  <span style="font-family:var(--font-body);font-size:12px;font-weight:500;text-transform:uppercase;letter-spacing:0.12em;color:var(--muted);">Production Dashboard</span>
</div>

<!-- DASHBOARD CONTENT -->
<div class="dashboard" style="padding-top:24px;">

  <!-- ============================================================ -->
  <!-- üî• FLAVOR SNAPSHOT ‚Äî What We Have (6 columns)                 -->
  <!-- ============================================================ -->
  <div class="section-header">
    <h2 class="section-header__title">üî• Flavor Snapshot</h2>
    <span class="section-header__badge" id="snapshot-date">Loading‚Ä¶</span>
  </div>
  <div class="data-table-wrap">
    <table class="data-table data-table--flavor-grid" id="flavor-snapshot">
      <thead>
        <tr>
          <th></th>
          <th style="color:#CC0000;">Hot</th>
          <th style="color:#3BA226;">Mild</th>
          <th style="color:#F5D623;">Mango</th>
          <th style="color:#1A1A1A;">Truffle</th>
          <th style="color:#2B6EC2;">Sriracha</th>
          <th style="color:#F5D623;">Thai</th>
        </tr>
      </thead>
      <tbody id="snapshot-body">
        <tr><td colspan="7" style="text-align:center;color:var(--muted);padding:24px;">Loading from Supabase‚Ä¶</td></tr>
      </tbody>
    </table>
  </div>

  <!-- ============================================================ -->
  <!-- üì¶ ORDER DEMAND ‚Äî What Each Order Needs (6 columns)           -->
  <!-- ============================================================ -->
  <div class="section-header" style="margin-top:32px;">
    <h2 class="section-header__title">üì¶ Order Demand</h2>
    <span class="section-header__badge">Bottles by flavor</span>
  </div>
  <div class="data-table-wrap">
    <table class="data-table data-table--flavor-grid" id="order-demand">
      <thead>
        <tr>
          <th>Order</th>
          <th style="color:#CC0000;">Hot</th>
          <th style="color:#3BA226;">Mild</th>
          <th style="color:#F5D623;">Mango</th>
          <th style="color:#1A1A1A;">Truffle</th>
          <th style="color:#2B6EC2;">Sriracha</th>
          <th style="color:#F5D623;">Thai</th>
        </tr>
      </thead>
      <tbody id="demand-body">
        <tr><td colspan="7" style="text-align:center;color:var(--muted);padding:24px;">Loading‚Ä¶</td></tr>
      </tbody>
    </table>
  </div>

  <!-- ============================================================ -->
  <!-- üìä GAP ANALYSIS ‚Äî What We Need to Produce                     -->
  <!-- ============================================================ -->
  <div class="section-header" style="margin-top:32px;">
    <h2 class="section-header__title">üìä Gap Analysis</h2>
    <span class="section-header__badge">Have vs Need</span>
  </div>
  <div class="data-table-wrap">
    <table class="data-table data-table--flavor-grid" id="gap-table">
      <thead>
        <tr>
          <th></th>
          <th style="color:#CC0000;">Hot</th>
          <th style="color:#3BA226;">Mild</th>
          <th style="color:#F5D623;">Mango</th>
          <th style="color:#1A1A1A;">Truffle</th>
          <th style="color:#2B6EC2;">Sriracha</th>
          <th style="color:#F5D623;">Thai</th>
        </tr>
      </thead>
      <tbody id="gap-body">
        <tr><td colspan="7" style="text-align:center;color:var(--muted);padding:24px;">Loading‚Ä¶</td></tr>
      </tbody>
    </table>
  </div>

  <!-- ============================================================ -->
  <!-- üç≥ COOK PLANNER ‚Äî Plan Your Ollas                            -->
  <!-- ============================================================ -->
  <div class="section-header" style="margin-top:32px;">
    <h2 class="section-header__title">üç≥ Cook Planner</h2>
    <span class="section-header__badge" id="cook-badge">Set ollas below</span>
  </div>
  <div class="data-table-wrap">
    <table class="data-table data-table--flavor-grid" id="cook-table">
      <thead>
        <tr>
          <th></th>
          <th style="color:#CC0000;">Hot</th>
          <th style="color:#3BA226;">Mild</th>
          <th style="color:#F5D623;">Mango</th>
          <th style="color:#1A1A1A;">Truffle</th>
          <th style="color:#2B6EC2;">Sriracha</th>
          <th style="color:#F5D623;">Thai</th>
        </tr>
      </thead>
      <tbody id="cook-body">
        <tr><td colspan="7" style="text-align:center;color:var(--muted);padding:24px;">Loading‚Ä¶</td></tr>
      </tbody>
    </table>
  </div>

  <!-- ============================================================ -->
  <!-- ü•ï DEEP ORDER ‚Äî Ingredient Shopping List                      -->
  <!-- ============================================================ -->
  <div class="section-header" style="margin-top:32px;">
    <h2 class="section-header__title">ü•ï Deep Order</h2>
    <span class="section-header__badge" id="deep-badge">Auto-calculated</span>
  </div>
  <div class="data-table-wrap" style="position:relative;">
    <table class="data-table data-table--compact" id="deep-table">
      <thead>
        <tr>
          <th>Ingredient</th>
          <th>Need</th>
          <th>Ordering</th>
          <th>Est. Cost</th>
          <th>Leftover</th>
        </tr>
      </thead>
      <tbody id="deep-body">
        <tr><td colspan="5" style="text-align:center;color:var(--muted);padding:24px;">Set ollas above to calculate‚Ä¶</td></tr>
      </tbody>
    </table>
    <div style="padding:16px 20px;display:flex;align-items:center;gap:16px;justify-content:space-between;" id="deep-footer">
      <span id="deep-total" style="font-family:var(--font-body);font-size:14px;font-weight:700;"></span>
      <button class="btn btn--orange" data-content="üìã Copy List" id="copy-deep-btn" style="font-size:13px;padding:8px 20px;display:none;">üìã Copy List</button>
    </div>
  </div>

  <!-- ============================================================ -->
  <!-- üß≠ NEXT STEPS ‚Äî Smart Suggestions                            -->
  <!-- ============================================================ -->
  <div class="section-header" style="margin-top:32px;">
    <h2 class="section-header__title">üß≠ Next Steps</h2>
    <span class="section-header__badge">Auto-generated</span>
  </div>
  <div class="next-steps-card" id="next-steps">
    <p style="color:var(--muted);padding:16px;">Calculating‚Ä¶</p>
  </div>


  <!-- ============================================================ -->
  <!-- üì¶ ORDERS PIPELINE ‚Äî Drag & Drop                             -->
  <!-- ============================================================ -->
  <div class="section-header">
    <h2 class="section-header__title">üì¶ Orders Pipeline</h2>
    <span class="section-header__badge">Drag to move</span>
  </div>

  <div class="orders-pipeline" id="orders-pipeline">
    <div class="pipeline-col" data-stage="new">
      <div class="pipeline-col__header">
        <span>New</span>
        <span class="pipeline-col__count" data-count>0</span>
      </div>
      <div class="pipeline-col__drop" data-drop="new"></div>
    </div>
    <div class="pipeline-col" data-stage="processing">
      <div class="pipeline-col__header">
        <span>Processing</span>
        <span class="pipeline-col__count" data-count>0</span>
      </div>
      <div class="pipeline-col__drop" data-drop="processing"></div>
    </div>
    <div class="pipeline-col" data-stage="shipped">
      <div class="pipeline-col__header">
        <span>Shipped</span>
        <span class="pipeline-col__count" data-count>0</span>
      </div>
      <div class="pipeline-col__drop" data-drop="shipped"></div>
    </div>
    <div class="pipeline-col" data-stage="paid">
      <div class="pipeline-col__header">
        <span>Paid</span>
        <span class="pipeline-col__count" data-count>0</span>
      </div>
      <div class="pipeline-col__drop" data-drop="paid"></div>
    </div>
  </div>


  <!-- (Inventory + Demand replaced by Flavor Snapshot + Order Demand + Gap Analysis above) -->


  <!-- ============================================================ -->
  <!-- üß† PRODUCTION BRAIN ‚Äî Supabase-driven, editable               -->
  <!-- ============================================================ -->
  <details class="brain-details" open>
    <summary>
      <div class="section-header" style="margin-bottom:0;flex:1;">
        <h2 class="section-header__title">üß† Production Brain</h2>
        <span class="section-header__badge" id="brain-date">Loading‚Ä¶</span>
      </div>
    </summary>

    <!-- Timeline -->
    <div class="brain-subsection">
      <div class="brain-subsection__title">üìÖ Timeline</div>
      <div class="data-table-wrap">
        <table class="data-table data-table--compact">
          <thead><tr><th>Date</th><th>Action</th><th>Status</th></tr></thead>
          <tbody id="brain-timeline"><tr><td colspan="3" style="text-align:center;color:var(--muted);padding:16px;">Loading‚Ä¶</td></tr></tbody>
        </table>
      </div>
    </div>

    <!-- Cash Flow -->
    <div class="brain-subsection">
      <div class="brain-subsection__title">üí∞ Cash Flow</div>
      <div class="data-table-wrap">
        <table class="data-table data-table--compact">
          <thead><tr><th>Date</th><th>In</th><th>Out</th><th>Balance</th></tr></thead>
          <tbody id="brain-cashflow"><tr><td colspan="4" style="text-align:center;color:var(--muted);padding:16px;">Loading‚Ä¶</td></tr></tbody>
        </table>
      </div>
    </div>

    <!-- Bills Owed -->
    <div class="brain-subsection">
      <div class="brain-subsection__title">üìã Bills Owed</div>
      <div class="data-table-wrap">
        <table class="data-table data-table--compact">
          <thead><tr><th>To</th><th>Amount</th><th>Due</th><th>Plan</th></tr></thead>
          <tbody id="brain-bills"><tr><td colspan="4" style="text-align:center;color:var(--muted);padding:16px;">Loading‚Ä¶</td></tr></tbody>
        </table>
      </div>
    </div>

    <!-- Ingredients -->
    <div class="brain-subsection">
      <div class="brain-subsection__title">ü•ï Ingredients</div>
      <div class="data-table-wrap">
        <table class="data-table data-table--compact">
          <thead><tr><th>Ingredient</th><th>Have</th><th>Need</th><th>Order</th></tr></thead>
          <tbody id="brain-ingredients"><tr><td colspan="4" style="text-align:center;color:var(--muted);padding:16px;">Loading‚Ä¶</td></tr></tbody>
        </table>
      </div>
    </div>

    <!-- Materials -->
    <div class="brain-subsection">
      <div class="brain-subsection__title">üì¶ Materials</div>
      <div class="data-table-wrap">
        <table class="data-table data-table--compact">
          <thead><tr><th>Item</th><th>Status</th><th>Note</th></tr></thead>
          <tbody id="brain-materials"><tr><td colspan="3" style="text-align:center;color:var(--muted);padding:16px;">Loading‚Ä¶</td></tr></tbody>
        </table>
      </div>
    </div>

    <!-- Reference -->
    <div class="brain-subsection">
      <div class="brain-subsection__title">üìñ Reference</div>
      <div class="brain-ref-card" id="brain-reference">Loading‚Ä¶</div>
    </div>

  </details>


  <!-- ============================================================ -->
  <!-- COGS BY FLAVOR                                                -->
  <!-- ============================================================ -->
  <div class="section-header">
    <h2 class="section-header__title">COGS by Flavor</h2>
    <span class="section-header__badge">Jan 2026</span>
  </div>
  <div class="data-table-wrap">
    <table class="data-table">
      <thead>
        <tr>
          <th>Flavor</th>
          <th>COGS</th>
          <th>UNFI Margin</th>
          <th>Amazon Margin</th>
          <th>Best Channel</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="col-name"><span class="flavor-dot" style="background:#2B6EC2;"></span>Sriracha</td>
          <td class="col-num">$2.74</td>
          <td class="col-num">‚Äî</td>
          <td class="col-num">63%</td>
          <td>Amazon</td>
          <td><span class="status-pill status-pill--green">Best COGS</span></td>
        </tr>
        <tr>
          <td class="col-name"><span class="flavor-dot" style="background:#F5D623;"></span>Mango</td>
          <td class="col-num">$3.31</td>
          <td class="col-num">31%</td>
          <td class="col-num">‚Äî</td>
          <td>UNFI</td>
          <td><span class="status-pill status-pill--green">Best UNFI</span></td>
        </tr>
        <tr>
          <td class="col-name"><span class="flavor-dot" style="background:#1A1A1A;"></span>Truffle</td>
          <td class="col-num">$3.34</td>
          <td class="col-num">‚Äî</td>
          <td class="col-num">70%</td>
          <td>Amazon</td>
          <td><span class="status-pill status-pill--yellow">63% Rev</span></td>
        </tr>
        <tr>
          <td class="col-name"><span class="flavor-dot" style="background:#3BA226;"></span>Mild</td>
          <td class="col-num">$3.37</td>
          <td class="col-num">30%</td>
          <td class="col-num">55%</td>
          <td>Amazon</td>
          <td><span class="status-pill status-pill--muted">Steady</span></td>
        </tr>
        <tr>
          <td class="col-name"><span class="flavor-dot" style="background:#F5D623;"></span>Thai</td>
          <td class="col-num">$3.42</td>
          <td class="col-num">‚Äî</td>
          <td class="col-num">54%</td>
          <td>Amazon</td>
          <td><span class="status-pill status-pill--muted">Steady</span></td>
        </tr>
        <tr>
          <td class="col-name"><span class="flavor-dot" style="background:#CC0000;"></span>Hot</td>
          <td class="col-num">$3.49</td>
          <td class="col-num">28%</td>
          <td class="col-num">53%</td>
          <td>Amazon</td>
          <td><span class="status-pill status-pill--orange">Highest COGS</span></td>
        </tr>
      </tbody>
    </table>
  </div>


  <!-- ============================================================ -->
  <!-- TWO-COLUMN: Channel Performance + Goal Progress               -->
  <!-- ============================================================ -->
  <div class="grid-2col">

    <!-- Channel Performance -->
    <div>
      <div class="section-header">
        <h2 class="section-header__title">Channel Revenue</h2>
        <span class="section-header__badge">vs Target</span>
      </div>
      <div class="channel-card">
        <div class="channel-bar-row">
          <span class="channel-bar__label">Amazon</span>
          <div class="channel-bar__track">
            <div class="channel-bar__fill channel-bar__fill--green" style="width:35%;"></div>
          </div>
          <span class="channel-bar__value">$3,500</span>
        </div>
        <div class="channel-bar-row">
          <span class="channel-bar__label">UNFI</span>
          <div class="channel-bar__track">
            <div class="channel-bar__fill channel-bar__fill--green" style="width:34%;"></div>
          </div>
          <span class="channel-bar__value">$3,400</span>
        </div>
        <div class="channel-bar-row">
          <span class="channel-bar__label">EXP</span>
          <div class="channel-bar__track">
            <div class="channel-bar__fill channel-bar__fill--orange" style="width:26%;"></div>
          </div>
          <span class="channel-bar__value">$2,650</span>
        </div>
        <div class="channel-bar-row">
          <span class="channel-bar__label">Costco</span>
          <div class="channel-bar__track">
            <div class="channel-bar__fill channel-bar__fill--yellow" style="width:0%;"></div>
          </div>
          <span class="channel-bar__value">$0</span>
        </div>
        <div class="channel-bar-row">
          <span class="channel-bar__label">Website</span>
          <div class="channel-bar__track">
            <div class="channel-bar__fill channel-bar__fill--yellow" style="width:0%;"></div>
          </div>
          <span class="channel-bar__value">$0</span>
        </div>
        <div class="channel-bar-row">
          <span class="channel-bar__label">Faire</span>
          <div class="channel-bar__track">
            <div class="channel-bar__fill channel-bar__fill--yellow" style="width:0%;"></div>
          </div>
          <span class="channel-bar__value">$0</span>
        </div>
      </div>
    </div>

    <!-- Goal Progress -->
    <div>
      <div class="section-header">
        <h2 class="section-header__title">Q2 Goal</h2>
        <span class="section-header__badge">$50K/mo</span>
      </div>
      <div class="goal-card">
        <p class="goal-card__label">Current Monthly</p>
        <p class="goal-card__amount">$6,900</p>
        <p class="goal-card__target">of $50,000 target ‚Äî $43,100 gap</p>
        <div class="goal-card__bar-track">
          <div class="goal-card__bar-fill" style="width:13.8%;"></div>
        </div>
      </div>
    </div>

  </div>


  <!-- ============================================================ -->
  <!-- ACTIVE BLOCKERS                                               -->
  <!-- ============================================================ -->
  <div class="section-header">
    <h2 class="section-header__title">Active Blockers</h2>
    <span class="section-header__badge">Feb 2026</span>
  </div>
  <div class="data-table-wrap">
    <table class="data-table">
      <thead>
        <tr>
          <th>Channel</th>
          <th>Blocker</th>
          <th>Impact</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="col-name">Costco</td>
          <td>Moses roadshow discussion</td>
          <td>$5K channel</td>
          <td><span class="status-pill status-pill--green">Unblocked</span></td>
        </tr>
        <tr>
          <td class="col-name">UNFI / WF</td>
          <td>John Lawson ‚Äî SKU expansion</td>
          <td>Mango in HVA</td>
          <td><span class="status-pill status-pill--orange">Waiting</span></td>
        </tr>
        <tr>
          <td class="col-name">UNFI</td>
          <td>Endless Aisle paperwork</td>
          <td>Online orders</td>
          <td><span class="status-pill status-pill--orange">Waiting</span></td>
        </tr>
        <tr>
          <td class="col-name">Amazon</td>
          <td>PPC barely running (~$66/60d)</td>
          <td>Traffic gap</td>
          <td><span class="status-pill status-pill--red">Action Needed</span></td>
        </tr>
      </tbody>
    </table>
  </div>


  <!-- ============================================================ -->
  <!-- üî¢ INVENTORY COUNTER ‚Äî Tap to update at the kitchen          -->
  <!-- ============================================================ -->
  <div class="section-header">
    <h2 class="section-header__title">üî¢ Quick Count</h2>
    <span class="section-header__badge">Tap to update</span>
  </div>

  <div class="inv-counter">
    <div class="inv-counter__card" id="inv-counter-card">

      <!-- BOTTLES (filled, by flavor) ‚Äî 3-col grid -->
      <div class="inv-counter__group-title">Bottles (Filled)</div>
      <div class="inv-counter__grid">
        <div class="inv-counter__row" data-key="bottles-hot">
          <span class="inv-counter__label"><span class="flavor-dot" style="background:#CC0000;"></span> Hot</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="442">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
        <div class="inv-counter__row" data-key="bottles-mild">
          <span class="inv-counter__label"><span class="flavor-dot" style="background:#3BA226;"></span> Mild</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="502">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
        <div class="inv-counter__row" data-key="bottles-mango">
          <span class="inv-counter__label"><span class="flavor-dot" style="background:#F5D623;"></span> Mango</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="48">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
        <div class="inv-counter__row" data-key="bottles-truffle">
          <span class="inv-counter__label"><span class="flavor-dot" style="background:#1A1A1A;"></span> Truffle</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="0">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
        <div class="inv-counter__row" data-key="bottles-sriracha">
          <span class="inv-counter__label"><span class="flavor-dot" style="background:#2B6EC2;"></span> Sriracha</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="40">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
        <div class="inv-counter__row" data-key="bottles-thai">
          <span class="inv-counter__label"><span class="flavor-dot" style="background:#F5D623;"></span> Thai</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="200">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
      </div>

      <!-- PACKAGING ‚Äî single items full-width -->
      <div class="inv-counter__group-title">Packaging</div>
      <div class="inv-counter__row" data-key="empty-bottles">
        <span class="inv-counter__label">Empty Bottles</span>
        <div class="inv-counter__controls">
          <button class="inv-counter__btn" data-action="sub">‚àí</button>
          <input class="inv-counter__value" type="number" min="0" value="14750">
          <button class="inv-counter__btn" data-action="add">+</button>
        </div>
      </div>
      <div class="inv-counter__row" data-key="seals">
        <span class="inv-counter__label">Seals (Foil Liners)</span>
        <div class="inv-counter__controls">
          <button class="inv-counter__btn" data-action="sub">‚àí</button>
          <input class="inv-counter__value" type="number" min="0" value="3000">
          <button class="inv-counter__btn" data-action="add">+</button>
        </div>
      </div>
      <div class="inv-counter__row" data-key="boxes-6pack">
        <span class="inv-counter__label">6-Pack Boxes (XL)</span>
        <div class="inv-counter__controls">
          <button class="inv-counter__btn" data-action="sub">‚àí</button>
          <input class="inv-counter__value" type="number" min="0" value="300">
          <button class="inv-counter__btn" data-action="add">+</button>
        </div>
      </div>

      <!-- CAPS ‚Äî by flavor, 3-col grid -->
      <div class="inv-counter__group-title">Caps</div>
      <div class="inv-counter__grid">
        <div class="inv-counter__row" data-key="caps-hot">
          <span class="inv-counter__label"><span class="flavor-dot" style="background:#CC0000;"></span> Hot</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="0">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
        <div class="inv-counter__row" data-key="caps-mild">
          <span class="inv-counter__label"><span class="flavor-dot" style="background:#3BA226;"></span> Mild</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="0">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
        <div class="inv-counter__row" data-key="caps-mango">
          <span class="inv-counter__label"><span class="flavor-dot" style="background:#F5D623;"></span> Mango</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="0">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
        <div class="inv-counter__row" data-key="caps-truffle">
          <span class="inv-counter__label"><span class="flavor-dot" style="background:#1A1A1A;"></span> Truffle</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="0">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
        <div class="inv-counter__row" data-key="caps-sriracha">
          <span class="inv-counter__label"><span class="flavor-dot" style="background:#2B6EC2;"></span> Sriracha</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="0">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
        <div class="inv-counter__row" data-key="caps-thai">
          <span class="inv-counter__label"><span class="flavor-dot" style="background:#F5D623;"></span> Thai</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="0">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
      </div>

      <!-- CAPS PRE-FILLED ‚Äî full-width -->
      <div class="inv-counter__row" data-key="caps-sealed">
        <span class="inv-counter__label">Caps Pre-Filled w/ Seals (total)</span>
        <div class="inv-counter__controls">
          <button class="inv-counter__btn" data-action="sub">‚àí</button>
          <input class="inv-counter__value" type="number" min="0" value="0">
          <button class="inv-counter__btn" data-action="add">+</button>
        </div>
      </div>

      <!-- LABELS ‚Äî by flavor, 3-col grid -->
      <div class="inv-counter__group-title">Labels</div>
      <div class="inv-counter__grid">
        <div class="inv-counter__row" data-key="labels-hot">
          <span class="inv-counter__label"><span class="flavor-dot" style="background:#CC0000;"></span> Hot</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="0">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
        <div class="inv-counter__row" data-key="labels-mild">
          <span class="inv-counter__label"><span class="flavor-dot" style="background:#3BA226;"></span> Mild</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="500">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
        <div class="inv-counter__row" data-key="labels-mango">
          <span class="inv-counter__label"><span class="flavor-dot" style="background:#F5D623;"></span> Mango</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="0">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
        <div class="inv-counter__row" data-key="labels-truffle">
          <span class="inv-counter__label"><span class="flavor-dot" style="background:#1A1A1A;"></span> Truffle</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="0">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
        <div class="inv-counter__row" data-key="labels-sriracha">
          <span class="inv-counter__label"><span class="flavor-dot" style="background:#2B6EC2;"></span> Sriracha</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="0">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
        <div class="inv-counter__row" data-key="labels-thai">
          <span class="inv-counter__label"><span class="flavor-dot" style="background:#F5D623;"></span> Thai</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="0">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
      </div>

      <!-- CASE STICKERS ‚Äî by flavor, 3-col grid -->
      <div class="inv-counter__group-title">Case Stickers</div>
      <div class="inv-counter__grid">
        <div class="inv-counter__row" data-key="stickers-hot">
          <span class="inv-counter__label"><span class="flavor-dot" style="background:#CC0000;"></span> Hot</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="0">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
        <div class="inv-counter__row" data-key="stickers-mild">
          <span class="inv-counter__label"><span class="flavor-dot" style="background:#3BA226;"></span> Mild</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="0">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
        <div class="inv-counter__row" data-key="stickers-mango">
          <span class="inv-counter__label"><span class="flavor-dot" style="background:#F5D623;"></span> Mango</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="0">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
        <div class="inv-counter__row" data-key="stickers-truffle">
          <span class="inv-counter__label"><span class="flavor-dot" style="background:#1A1A1A;"></span> Truffle</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="0">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
        <div class="inv-counter__row" data-key="stickers-sriracha">
          <span class="inv-counter__label"><span class="flavor-dot" style="background:#2B6EC2;"></span> Sriracha</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="0">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
        <div class="inv-counter__row" data-key="stickers-thai">
          <span class="inv-counter__label"><span class="flavor-dot" style="background:#F5D623;"></span> Thai</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="0">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
      </div>

      <!-- DRUMS ‚Äî by flavor, 3-col grid -->
      <div class="inv-counter__group-title">Drums</div>
      <div class="inv-counter__grid">
        <div class="inv-counter__row" data-key="drums-hot">
          <span class="inv-counter__label"><span class="flavor-dot" style="background:#CC0000;"></span> Hot</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="0">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
        <div class="inv-counter__row" data-key="drums-mild">
          <span class="inv-counter__label"><span class="flavor-dot" style="background:#3BA226;"></span> Mild</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="0">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
        <div class="inv-counter__row" data-key="drums-mango">
          <span class="inv-counter__label"><span class="flavor-dot" style="background:#F5D623;"></span> Mango</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="2">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
        <div class="inv-counter__row" data-key="drums-truffle">
          <span class="inv-counter__label"><span class="flavor-dot" style="background:#1A1A1A;"></span> Truffle</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="1">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
        <div class="inv-counter__row" data-key="drums-sriracha">
          <span class="inv-counter__label"><span class="flavor-dot" style="background:#2B6EC2;"></span> Sriracha</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="0">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
      </div>

      <!-- INGREDIENTS ‚Äî 3-col grid -->
      <div class="inv-counter__group-title">Ingredients</div>
      <div class="inv-counter__grid">
        <div class="inv-counter__row" data-key="ing-carrots">
          <span class="inv-counter__label">Carrots (lb)</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="100">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
        <div class="inv-counter__row" data-key="ing-lime">
          <span class="inv-counter__label">Lime Juice</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="4">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
        <div class="inv-counter__row" data-key="ing-garlic">
          <span class="inv-counter__label">Garlic</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="1">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
        <div class="inv-counter__row" data-key="ing-culantro">
          <span class="inv-counter__label">Culantro</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="0">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
        <div class="inv-counter__row" data-key="ing-habanero">
          <span class="inv-counter__label">Habanero</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="0">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
        <div class="inv-counter__row" data-key="ing-acv">
          <span class="inv-counter__label">ACV</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="1">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
        <div class="inv-counter__row" data-key="ing-vinegar">
          <span class="inv-counter__label">White Vinegar</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="3">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
        <div class="inv-counter__row" data-key="ing-truffle-oil">
          <span class="inv-counter__label">Truffle Flavoring</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="0">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
        <div class="inv-counter__row" data-key="ing-salt">
          <span class="inv-counter__label">Salt (bags)</span>
          <div class="inv-counter__controls">
            <button class="inv-counter__btn" data-action="sub">‚àí</button>
            <input class="inv-counter__value" type="number" min="0" value="0">
            <button class="inv-counter__btn" data-action="add">+</button>
          </div>
        </div>
      </div>

      <div class="inv-counter__timestamp" id="inv-timestamp">‚Äî</div>
    </div>
  </div>

  <!-- Inventory Counter JS -->
  <script>
  (function() {
    const STORAGE_KEY = 'tango-inventory';
    const TS_KEY = 'tango-inventory-ts';
    const card = document.getElementById('inv-counter-card');
    const tsEl = document.getElementById('inv-timestamp');

    // Load saved values
    function load() {
      try {
        const data = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
        card.querySelectorAll('.inv-counter__row').forEach(row => {
          const key = row.dataset.key;
          if (key && data[key] !== undefined) {
            row.querySelector('.inv-counter__value').value = data[key];
          }
        });
        const ts = localStorage.getItem(TS_KEY);
        if (ts) tsEl.textContent = 'Last updated: ' + ts;
      } catch(e) {}
    }

    // Save all values
    function save() {
      const data = {};
      card.querySelectorAll('.inv-counter__row').forEach(row => {
        const key = row.dataset.key;
        const val = parseInt(row.querySelector('.inv-counter__value').value) || 0;
        if (key) data[key] = val;
      });
      const now = new Date();
      const ts = now.toLocaleDateString('en-US', { month:'short', day:'numeric' })
               + ' ' + now.toLocaleTimeString('en-US', { hour:'numeric', minute:'2-digit' });
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      localStorage.setItem(TS_KEY, ts);
      tsEl.textContent = 'Last updated: ' + ts;
    }

    // Button clicks
    card.addEventListener('click', function(e) {
      const btn = e.target.closest('.inv-counter__btn');
      if (!btn) return;
      const input = btn.parentElement.querySelector('.inv-counter__value');
      let val = parseInt(input.value) || 0;
      if (btn.dataset.action === 'add') val++;
      else if (btn.dataset.action === 'sub' && val > 0) val--;
      input.value = val;
      save();
    });

    // Direct input edits
    card.addEventListener('input', function(e) {
      if (e.target.classList.contains('inv-counter__value')) {
        save();
      }
    });

    // Long-press for fast +/- (hold button)
    let holdTimer = null;
    let holdInterval = null;
    card.addEventListener('pointerdown', function(e) {
      const btn = e.target.closest('.inv-counter__btn');
      if (!btn) return;
      holdTimer = setTimeout(() => {
        holdInterval = setInterval(() => {
          const input = btn.parentElement.querySelector('.inv-counter__value');
          let val = parseInt(input.value) || 0;
          if (btn.dataset.action === 'add') val++;
          else if (btn.dataset.action === 'sub' && val > 0) val--;
          input.value = val;
          save();
        }, 80);
      }, 400);
    });
    function stopHold() {
      clearTimeout(holdTimer);
      clearInterval(holdInterval);
      holdTimer = null;
      holdInterval = null;
    }
    card.addEventListener('pointerup', stopHold);
    card.addEventListener('pointerleave', stopHold);
    card.addEventListener('pointercancel', stopHold);

    load();
  })();
  </script>



</div>



<!-- ============================================================ -->
<!-- Supabase CDN                                                  -->
<!-- ============================================================ -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>

<!-- ============================================================ -->
<!-- üî• PRODUCTION ENGINE ‚Äî Supabase-backed, editable               -->
<!-- ============================================================ -->
<script>
(function() {
  var SUPA_URL = 'https://muowpjabnjkqgwgzfmoj.supabase.co';
  var SUPA_KEY = 'sb_publishable_e-Kx6L_hOKZaG1toGiKidw__weM4n7n';
  var sb = null;
  try { sb = supabase.createClient(SUPA_URL, SUPA_KEY); } catch(e) {}

  var FLAVORS = ['hot','mild','mango','truffle','sriracha','thai'];
  var DRUM_BOTTLES = 625;

  // ‚îÄ‚îÄ Recipe constants (confirmed Feb 2026) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  var OLLA_YIELDS = { hot:325, mild:325, truffle:325, thai:325, mango:450, sriracha:450 };
  var BATCHES_PER_OLLA = { hot:4, mild:4, truffle:4, thai:4, mango:2, sriracha:2 };

  // Per-batch ingredient needs for standard flavors (Hot/Mild/Truffle/Thai)
  // Derived from 3-olla / 12-batch baseline (400lb carrots, etc.)
  var STD_BATCH = {
    carrots:  { amt:33.33, unit:'lb' },
    garlic:   { amt:12.5,  unit:'lb' },
    lime:     { amt:1.67,  unit:'gal' },
    culantro: { amt:3.5,   unit:'lb' },
    habanero: { amt:1.67,  unit:'lb' },
    acv:      { amt:3.33,  unit:'gal' },
    salt:     { amt:4.17,  unit:'lb' }
  };

  // Per-batch for Sriracha
  var SRI_BATCH = {
    red_jalapeno: { amt:25, unit:'lb' },
    garlic:       { amt:13, unit:'lb' },
    sugar:        { amt:4,  unit:'lb' },
    salt:         { amt:3,  unit:'lb' },
    white_vinegar:{ amt:11, unit:'lb', kitchen:true },
    water:        { amt:10, unit:'lb', kitchen:true }
  };

  // Per-batch for Mango (partial ‚Äî only mango fruit known)
  var MANGO_BATCH = {
    mango_fruit: { amt:50, unit:'lb' },
    carrots:     { amt:33.33, unit:'lb' },
    garlic:      { amt:12.5,  unit:'lb' },
    lime:        { amt:1.67,  unit:'gal' },
    culantro:    { amt:3.5,   unit:'lb' },
    habanero:    { amt:1.67,  unit:'lb' },
    acv:         { amt:3.33,  unit:'gal' },
    salt:        { amt:4.17,  unit:'lb' }
  };

  // Purchasable units from Deep + pricing
  var UNITS = {
    carrots:      { pkg:25,  unit:'lb',  label:'25lb bag',     name:'carrots',              pLo:18,    pHi:28 },
    garlic:       { pkg:30,  unit:'lb',  label:'30lb box',     name:'garlic',               pLo:80,    pHi:109 },
    lime:         { pkg:4,   unit:'gal', label:'case (4gal)',  name:'lime juice',           pLo:58,    pHi:58 },
    culantro:     { pkg:14,  unit:'lb',  label:'14lb box',     name:'culantro',             pLo:69,    pHi:69 },
    habanero:     { pkg:10,  unit:'lb',  label:'~10lb box',    name:'habanero',             pLo:28,    pHi:30 },
    acv:          { pkg:4,   unit:'gal', label:'case (4gal)',  name:'apple cider vinegar',  pLo:38.75, pHi:38.75 },
    salt:         { pkg:50,  unit:'lb',  label:'50lb bag',     name:'salt',                 pLo:13,    pHi:14 },
    red_jalapeno: { pkg:25,  unit:'lb',  label:'~25lb case',   name:'red jalapeno',         pLo:44.75, pHi:44.75 },
    sugar:        { pkg:50,  unit:'lb',  label:'50lb bag',     name:'cane sugar',           pLo:37,    pHi:37 },
    mango_fruit:  { pkg:30,  unit:'lb',  label:'30lb case',    name:'mango',                pLo:46.50, pHi:46.50 }
  };
  var DELIVERY_FEE = 80;

  // Global for copy button
  var _deepListText = '';

  function fmt(n) { return n === 0 ? '‚Äî' : n.toLocaleString(); }
  function $(id) { return document.getElementById(id); }

  async function loadS(key) {
    if (!sb) return null;
    try {
      var r = await sb.from('settings').select('value').eq('key', key).single();
      return r.data ? r.data.value : null;
    } catch(e) { return null; }
  }
  function saveS(key, value) {
    if (!sb) return;
    value.updated = new Date().toLocaleDateString('en-US', { month:'short', day:'numeric', year:'numeric' });
    sb.from('settings').upsert({ key: key, value: value, updated_at: new Date().toISOString() }, { onConflict: 'key' });
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // BOOT ‚Äî load everything, render everything
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  async function boot() {
    var [packed, drums, demand, timeline, cashflow, bills, ingOnHand, ingNeeded, materials, shifts, conversions, ordersRes, cookPlanData] = await Promise.all([
      loadS('tango_production_packed'),
      loadS('tango_production_drums'),
      loadS('tango_production_demand'),
      loadS('tango_production_timeline'),
      loadS('tango_production_cashflow'),
      loadS('tango_production_bills'),
      loadS('tango_production_ingredients_on_hand'),
      loadS('tango_production_ingredients_needed'),
      loadS('tango_production_materials'),
      loadS('tango_production_shifts'),
      loadS('tango_production_conversions'),
      sb ? sb.from('tango_orders').select('*').order('created_at') : { data: [] },
      loadS('tango_production_cook_plan')
    ]);
    var allOrders = (ordersRes && ordersRes.data) || [];

    if (!packed || !drums) {
      $('snapshot-body').innerHTML = '<tr><td colspan="7" style="text-align:center;color:var(--muted);padding:24px;">No production data yet.</td></tr>';
      return;
    }

    // ‚îÄ‚îÄ Lookup maps ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    var packedMap = {};
    (packed.packed || []).forEach(function(p) { packedMap[p.flavor] = p.bottles || 0; });
    var drumsMap = {};
    (drums.drums || []).forEach(function(d) { drumsMap[d.flavor] = d; });

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // TABLE 1: Flavor Snapshot (EDITABLE packed + drums)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    $('snapshot-date').textContent = 'Updated ' + (packed.updated || '?');

    function renderSnapshot() {
      var h = '';
      // Row 1: Packed Bottles (editable)
      h += '<tr><td class="col-name" style="font-weight:600;">Packed Bottles</td>';
      FLAVORS.forEach(function(f) {
        var v = packedMap[f] || 0;
        h += '<td><input class="edit-input" type="number" min="0" data-field="packed" data-flavor="' + f + '" value="' + v + '"></td>';
      });
      h += '</tr>';
      // Row 2: 6-Packs (auto-calc)
      h += '<tr><td class="col-name" style="font-weight:600;">6-Packs (cases)</td>';
      FLAVORS.forEach(function(f) {
        var v = Math.floor((packedMap[f] || 0) / 6);
        h += '<td class="' + (v === 0 ? 'cell-zero' : '') + '" data-calc="cases-' + f + '">' + fmt(v) + '</td>';
      });
      h += '</tr>';
      // Row 3: Botes / drums (editable)
      h += '<tr><td class="col-name" style="font-weight:600;">Botes (drums)</td>';
      FLAVORS.forEach(function(f) {
        var v = drumsMap[f] ? drumsMap[f].drums : 0;
        h += '<td><input class="edit-input" type="number" min="0" data-field="drums" data-flavor="' + f + '" value="' + v + '"></td>';
      });
      h += '</tr>';
      // Row 4: Total once packed (auto-calc)
      h += '<tr class="row-total"><td>Total Once Packed</td>';
      FLAVORS.forEach(function(f) {
        var v = (packedMap[f] || 0) + (drumsMap[f] ? drumsMap[f].bottles_worth : 0);
        h += '<td data-calc="total-' + f + '">' + fmt(v) + '</td>';
      });
      h += '</tr>';
      $('snapshot-body').innerHTML = h;
    }
    renderSnapshot();

    // Editable snapshot handlers
    $('flavor-snapshot').addEventListener('change', function(e) {
      var inp = e.target;
      if (!inp.classList.contains('edit-input')) return;
      var field = inp.dataset.field;
      var flavor = inp.dataset.flavor;
      var val = parseInt(inp.value) || 0;
      if (val < 0) val = 0;
      inp.value = val;

      if (field === 'packed') {
        packedMap[flavor] = val;
        var arr = packed.packed || [];
        var found = arr.find(function(p) { return p.flavor === flavor; });
        if (found) found.bottles = val; else arr.push({ flavor: flavor, bottles: val });
        packed.packed = arr;
        saveS('tango_production_packed', packed);
      } else if (field === 'drums') {
        if (!drumsMap[flavor]) drumsMap[flavor] = { flavor: flavor, drums: 0, bottles_worth: 0 };
        drumsMap[flavor].drums = val;
        drumsMap[flavor].bottles_worth = val * DRUM_BOTTLES;
        var darr = drums.drums || [];
        var df = darr.find(function(d) { return d.flavor === flavor; });
        if (df) { df.drums = val; df.bottles_worth = val * DRUM_BOTTLES; }
        else darr.push(drumsMap[flavor]);
        drums.drums = darr;
        saveS('tango_production_drums', drums);
      }

      // Recalc derived cells
      FLAVORS.forEach(function(f) {
        var casesEl = document.querySelector('[data-calc="cases-' + f + '"]');
        var totalEl = document.querySelector('[data-calc="total-' + f + '"]');
        var p = packedMap[f] || 0;
        var dw = drumsMap[f] ? drumsMap[f].bottles_worth : 0;
        if (casesEl) { casesEl.textContent = fmt(Math.floor(p / 6)); casesEl.className = p === 0 ? 'cell-zero' : ''; }
        if (totalEl) totalEl.textContent = fmt(p + dw);
      });

      $('snapshot-date').textContent = 'Updated ' + new Date().toLocaleDateString('en-US', { month:'short', day:'numeric' });
      renderGap();
    });

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // TABLE 2: Order Demand
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    var activeOrders = allOrders.filter(function(o) {
      return o.items && o.items.length > 0 && (o.stage === 'new' || o.stage === 'processing');
    });

    var demandTotals = {};
    FLAVORS.forEach(function(f) { demandTotals[f] = 0; });

    var dhtml = '';
    activeOrders.forEach(function(order) {
      var fm = {};
      (order.items || []).forEach(function(it) { fm[it.flavor.toLowerCase()] = (it.cases || 0) * 6; });
      dhtml += '<tr><td class="col-name" style="font-weight:600;">' + (order.channel || '') + '<br><span style="font-size:11px;color:var(--muted);">' + (order.title || '') + '</span></td>';
      FLAVORS.forEach(function(f) {
        var v = fm[f] || 0; demandTotals[f] += v;
        dhtml += '<td class="' + (v === 0 ? 'cell-zero' : '') + '">' + fmt(v) + '</td>';
      });
      dhtml += '</tr>';
    });

    if (demand && demand.demand) {
      var extra = {};
      FLAVORS.forEach(function(f) { extra[f] = 0; });
      demand.demand.forEach(function(d) {
        extra[d.flavor] = (d.amazon || 0) + (d.faire_dtc || 0) + (d.samples || 0);
      });
      if (FLAVORS.some(function(f) { return extra[f] > 0; })) {
        dhtml += '<tr><td class="col-name" style="font-weight:600;">Amazon + Faire<br><span style="font-size:11px;color:var(--muted);">DTC + Samples</span></td>';
        FLAVORS.forEach(function(f) {
          demandTotals[f] += extra[f];
          dhtml += '<td class="' + (extra[f] === 0 ? 'cell-zero' : '') + '">' + fmt(extra[f]) + '</td>';
        });
        dhtml += '</tr>';
      }
    }
    dhtml += '<tr class="row-total"><td>Total Need</td>';
    FLAVORS.forEach(function(f) { dhtml += '<td>' + fmt(demandTotals[f]) + '</td>'; });
    dhtml += '</tr>';
    $('demand-body').innerHTML = dhtml;

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // TABLE 3: Gap Analysis (re-renders when snapshot changes)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    var gaps = {};
    function renderGap() {
      var g = '';
      g += '<tr><td class="col-name" style="font-weight:600;">Total Need</td>';
      FLAVORS.forEach(function(f) { g += '<td class="' + (demandTotals[f] === 0 ? 'cell-zero' : '') + '">' + fmt(demandTotals[f]) + '</td>'; });
      g += '</tr><tr><td class="col-name" style="font-weight:600;">Packed (have)</td>';
      FLAVORS.forEach(function(f) { var v = packedMap[f] || 0; g += '<td class="' + (v === 0 ? 'cell-zero' : 'cell-ok') + '">' + fmt(v) + '</td>'; });
      g += '</tr><tr><td class="col-name" style="font-weight:600;">In Drums</td>';
      FLAVORS.forEach(function(f) { var v = drumsMap[f] ? drumsMap[f].bottles_worth : 0; g += '<td class="' + (v === 0 ? 'cell-zero' : 'cell-ok') + '">' + fmt(v) + '</td>'; });
      g += '</tr><tr class="row-total"><td>Gap</td>';
      FLAVORS.forEach(function(f) {
        var gap = demandTotals[f] - (packedMap[f] || 0) - (drumsMap[f] ? drumsMap[f].bottles_worth : 0);
        gaps[f] = gap;
        g += '<td class="' + (gap <= 0 ? 'cell-ok' : 'cell-bad') + '">' + (gap <= 0 ? '+' + fmt(Math.abs(gap)) : fmt(gap)) + '</td>';
      });
      g += '</tr>';
      $('gap-body').innerHTML = g;
      renderNextSteps();
    }
    renderGap();

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // COOK PLANNER + INGREDIENT CALCULATOR
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    var ollasPlan = {};
    FLAVORS.forEach(function(f) { ollasPlan[f] = 0; });
    if (cookPlanData && cookPlanData.ollas) {
      FLAVORS.forEach(function(f) { ollasPlan[f] = cookPlanData.ollas[f] || 0; });
    }

    function getRecipeForFlavor(f) {
      if (f === 'sriracha') return SRI_BATCH;
      if (f === 'mango') return MANGO_BATCH;
      return STD_BATCH;
    }

    function calcIngredients() {
      var needs = {};
      FLAVORS.forEach(function(f) {
        var o = ollasPlan[f] || 0;
        if (o <= 0) return;
        var batches = o * BATCHES_PER_OLLA[f];
        var recipe = getRecipeForFlavor(f);
        Object.keys(recipe).forEach(function(ing) {
          var r = recipe[ing];
          if (r.kitchen) return;
          if (!needs[ing]) needs[ing] = { amt:0, unit:r.unit };
          needs[ing].amt += r.amt * batches;
        });
      });
      return needs;
    }

    function renderCookPlan() {
      var h = '';
      var totalOllas = 0;
      FLAVORS.forEach(function(f) { totalOllas += (ollasPlan[f] || 0); });

      // Row 1: Ollas to Cook (editable)
      h += '<tr><td class="col-name" style="font-weight:600;">Ollas to Cook</td>';
      FLAVORS.forEach(function(f) {
        h += '<td><input class="edit-input" type="number" min="0" max="9" data-field="ollas" data-flavor="' + f + '" value="' + (ollasPlan[f] || 0) + '" style="width:48px;"></td>';
      });
      h += '</tr>';

      // Row 2: Bottles Produced (auto-calc)
      h += '<tr><td class="col-name" style="font-weight:600;">Bottles Produced</td>';
      FLAVORS.forEach(function(f) {
        var v = (ollasPlan[f] || 0) * OLLA_YIELDS[f];
        h += '<td class="' + (v === 0 ? 'cell-zero' : '') + '">' + fmt(v) + '</td>';
      });
      h += '</tr>';

      // Row 3: Post-Cook Total (inventory + produced)
      h += '<tr><td class="col-name" style="font-weight:600;">Post-Cook Total</td>';
      FLAVORS.forEach(function(f) {
        var have = (packedMap[f] || 0) + (drumsMap[f] ? drumsMap[f].bottles_worth : 0);
        var produced = (ollasPlan[f] || 0) * OLLA_YIELDS[f];
        var total = have + produced;
        h += '<td class="' + (total === 0 ? 'cell-zero' : '') + '">' + fmt(total) + '</td>';
      });
      h += '</tr>';

      // Row 4: Surplus After Orders (post-cook - demand)
      h += '<tr class="row-total"><td>Surplus After Orders</td>';
      FLAVORS.forEach(function(f) {
        var have = (packedMap[f] || 0) + (drumsMap[f] ? drumsMap[f].bottles_worth : 0);
        var produced = (ollasPlan[f] || 0) * OLLA_YIELDS[f];
        var surplus = have + produced - (demandTotals[f] || 0);
        h += '<td class="' + (surplus < 0 ? 'cell-bad' : 'cell-ok') + '">' + (surplus >= 0 ? '+' : '') + fmt(surplus) + '</td>';
      });
      h += '</tr>';

      $('cook-body').innerHTML = h;
      $('cook-badge').textContent = totalOllas > 0 ? totalOllas + ' olla' + (totalOllas > 1 ? 's' : '') + ' planned' : 'Set ollas below';

      renderDeepOrder();
    }

    function renderDeepOrder() {
      var needs = calcIngredients();
      var keys = Object.keys(needs);

      if (keys.length === 0) {
        $('deep-body').innerHTML = '<tr><td colspan="5" style="text-align:center;color:var(--muted);padding:24px;">Set ollas above to calculate‚Ä¶</td></tr>';
        $('deep-total').textContent = '';
        $('copy-deep-btn').style.display = 'none';
        _deepListText = '';
        return;
      }

      // Sort: carrots first, then garlic, lime, culantro, habanero, acv, salt, then sriracha-specific
      var sortOrder = ['carrots','garlic','lime','culantro','habanero','acv','salt','red_jalapeno','sugar','mango_fruit'];
      keys.sort(function(a, b) {
        var ai = sortOrder.indexOf(a); if (ai < 0) ai = 99;
        var bi = sortOrder.indexOf(b); if (bi < 0) bi = 99;
        return ai - bi;
      });

      var h = '';
      var totalCostLo = 0;
      var totalCostHi = 0;
      var lines = [];

      keys.forEach(function(ing) {
        var n = needs[ing];
        var u = UNITS[ing];
        if (!u) return;

        var rawAmt = Math.round(n.amt * 10) / 10;
        var pkgs = Math.ceil(n.amt / u.pkg);
        var ordered = pkgs * u.pkg;
        var leftover = Math.round((ordered - n.amt) * 10) / 10;

        var costLo = pkgs * u.pLo;
        var costHi = pkgs * u.pHi;
        totalCostLo += costLo;
        totalCostHi += costHi;

        var costStr = u.pLo === u.pHi ? '$' + costLo.toFixed(0) : '$' + costLo.toFixed(0) + '‚Äì$' + costHi.toFixed(0);
        var leftStr = leftover <= 0.5 ? '~0' : Math.round(leftover) + ' ' + n.unit;

        // Need column
        var needStr = Math.round(rawAmt) + ' ' + n.unit;
        // Ordering column
        var orderStr = Math.round(ordered) + n.unit + ' (' + pkgs + ' ' + u.label.split(' ').slice(0, -1).join(' ') + ')';
        if (pkgs === 1) orderStr = Math.round(ordered) + n.unit + ' (1 ' + u.label + ')';
        else orderStr = Math.round(ordered) + n.unit + ' (' + pkgs + ' ' + u.label + 's)';

        h += '<tr>';
        h += '<td class="col-name">' + u.name.charAt(0).toUpperCase() + u.name.slice(1) + '</td>';
        h += '<td class="col-num">' + needStr + '</td>';
        h += '<td class="col-num" style="font-weight:700;">' + Math.round(ordered) + ' ' + n.unit + '<br><span style="font-size:11px;color:var(--muted);">' + pkgs + ' √ó ' + u.label + '</span></td>';
        h += '<td class="col-num">' + costStr + '</td>';
        h += '<td class="col-num" style="color:' + (leftover <= 0.5 ? 'var(--muted)' : 'var(--green)') + ';">' + leftStr + '</td>';
        h += '</tr>';

        // Build copy line
        if (n.unit === 'gal') {
          lines.push(Math.round(ordered) + ' gallons ' + u.name + ' (' + pkgs + ' cases)');
        } else {
          if (pkgs === 1) {
            lines.push(Math.round(ordered) + 'lb ' + u.name + ' (1 ' + u.label + ')');
          } else {
            lines.push(Math.round(ordered) + 'lb ' + u.name + ' (' + pkgs + ' ' + u.label + 's)');
          }
        }
      });

      // Delivery row
      h += '<tr class="row-total"><td>Delivery</td><td></td><td></td><td class="col-num">$' + DELIVERY_FEE + '</td><td></td></tr>';
      totalCostLo += DELIVERY_FEE;
      totalCostHi += DELIVERY_FEE;

      $('deep-body').innerHTML = h;

      var totalStr = totalCostLo === totalCostHi
        ? 'Est. Total: $' + totalCostLo.toFixed(0)
        : 'Est. Total: $' + totalCostLo.toFixed(0) + ' ‚Äì $' + totalCostHi.toFixed(0);
      $('deep-total').textContent = totalStr;
      $('copy-deep-btn').style.display = '';

      _deepListText = lines.join('\n');
    }

    renderCookPlan();

    // Cook planner edit handlers
    $('cook-table').addEventListener('change', function(e) {
      var inp = e.target;
      if (!inp.classList.contains('edit-input')) return;
      var flavor = inp.dataset.flavor;
      var val = parseInt(inp.value) || 0;
      if (val < 0) val = 0;
      if (val > 9) val = 9;
      inp.value = val;
      ollasPlan[flavor] = val;

      // Save to Supabase
      var planObj = cookPlanData || {};
      planObj.ollas = {};
      FLAVORS.forEach(function(f) { planObj.ollas[f] = ollasPlan[f]; });
      cookPlanData = planObj;
      saveS('tango_production_cook_plan', planObj);

      renderCookPlan();
    });

    // Copy list button
    $('copy-deep-btn').addEventListener('click', function() {
      if (!_deepListText) return;
      navigator.clipboard.writeText(_deepListText).then(function() {
        var btn = $('copy-deep-btn');
        btn.setAttribute('data-content', '‚úÖ Copied!');
        setTimeout(function() { btn.setAttribute('data-content', 'üìã Copy List'); }, 2000);
      });
    });

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // SECTION 4: Next Steps (auto-generated)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function renderNextSteps() {
      var steps = [];
      var cook = [];
      FLAVORS.forEach(function(f) { if (gaps[f] > 0) cook.push('<strong>' + f.charAt(0).toUpperCase() + f.slice(1) + '</strong> (' + fmt(gaps[f]) + ' short)'); });
      if (cook.length > 0) steps.push('Cook needed: ' + cook.join(', ') + '. Mon Feb 24 planned ($400).');
      var pack = [];
      FLAVORS.forEach(function(f) {
        var dw = drumsMap[f] ? drumsMap[f].bottles_worth : 0;
        if (dw > 0 && demandTotals[f] > (packedMap[f] || 0)) pack.push('<strong>' + f.charAt(0).toUpperCase() + f.slice(1) + '</strong> (' + fmt(Math.min(dw, demandTotals[f] - (packedMap[f] || 0))) + ')');
      });
      if (pack.length > 0) steps.push('Pack from drums: ' + pack.join(', ') + '. Thu Feb 27 planned ($1,000).');
      steps.push('Order more <strong>Mild labels</strong> ‚Äî only ~500 left.');
      steps.push('Contact <strong>Jason at EXP</strong> ‚Äî push pickup to ~Feb 28.');
      var s = '';
      steps.forEach(function(t, i) { s += '<div class="next-step-item"><span class="next-step-num">' + (i + 1) + '</span><span class="next-step-text">' + t + '</span></div>'; });
      $('next-steps').innerHTML = s;
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // PRODUCTION BRAIN ‚Äî Timeline, Cash Flow, Bills, etc.
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    $('brain-date').textContent = 'Supabase-backed';

    // ‚îÄ‚îÄ Timeline ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    if (timeline && timeline.events) {
      var statusMap = { done:'green', scheduled:'orange', waiting:'yellow', pending:'muted', todo:'red' };
      var statusCycle = ['done','scheduled','waiting','pending','todo'];
      var th = '';
      timeline.events.forEach(function(ev, idx) {
        var pillCls = 'status-pill--' + (statusMap[ev.status] || 'muted');
        var label = ev.status.charAt(0).toUpperCase() + ev.status.slice(1);
        var highlight = (ev.status === 'scheduled' || ev.status === 'todo') ? ' style="background:rgba(255,149,0,0.08);"' : '';
        th += '<tr' + highlight + '><td class="col-num">' + ev.date + '</td><td>' + ev.action + '</td>';
        th += '<td><span class="status-pill ' + pillCls + ' status-pill--tap" data-tl-idx="' + idx + '">' + label + '</span></td></tr>';
      });
      $('brain-timeline').innerHTML = th;

      $('brain-timeline').addEventListener('click', function(e) {
        var pill = e.target.closest('.status-pill--tap[data-tl-idx]');
        if (!pill) return;
        var idx = parseInt(pill.dataset.tlIdx);
        var ev = timeline.events[idx];
        var ci = statusCycle.indexOf(ev.status);
        ev.status = statusCycle[(ci + 1) % statusCycle.length];
        pill.className = 'status-pill status-pill--' + (statusMap[ev.status] || 'muted') + ' status-pill--tap';
        pill.textContent = ev.status.charAt(0).toUpperCase() + ev.status.slice(1);
        var tr = pill.closest('tr');
        tr.style.background = (ev.status === 'scheduled' || ev.status === 'todo') ? 'rgba(255,149,0,0.08)' : '';
        saveS('tango_production_timeline', timeline);
      });
    }

    // ‚îÄ‚îÄ Cash Flow ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    if (cashflow && cashflow.timeline) {
      var ch = '';
      cashflow.timeline.forEach(function(row) {
        var balCls = row.balance < 0 ? 'cell-bad' : (row.balance < 500 ? 'cell-warn' : '');
        var note = row.note ? ' <span style="font-size:10px;color:var(--muted);">(' + row.note + ')</span>' : '';
        ch += '<tr><td class="col-num">' + row.date + '</td>';
        ch += '<td class="col-num" style="color:var(--green);">' + (row.in || '‚Äî') + '</td>';
        ch += '<td class="col-num" style="color:#CC0000;">' + (row.out || '‚Äî') + '</td>';
        ch += '<td class="col-num ' + balCls + '">$' + row.balance.toLocaleString() + note + '</td></tr>';
      });
      $('brain-cashflow').innerHTML = ch;
    }

    // ‚îÄ‚îÄ Bills ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    if (bills && bills.bills) {
      var bh = '';
      bills.bills.forEach(function(bill, idx) {
        bh += '<tr><td class="col-name">' + bill.to + '</td>';
        bh += '<td class="col-num">$' + bill.amount.toLocaleString() + '</td>';
        bh += '<td class="col-num">' + bill.due + '</td>';
        bh += '<td><input class="edit-input edit-input--text" type="text" data-bill-idx="' + idx + '" value="' + (bill.plan || '') + '"></td></tr>';
      });
      bh += '<tr class="row-total"><td>Total</td><td class="col-num">$' + (bills.total || 0).toLocaleString() + '</td><td></td><td></td></tr>';
      $('brain-bills').innerHTML = bh;

      $('brain-bills').addEventListener('change', function(e) {
        var inp = e.target;
        if (inp.dataset.billIdx === undefined) return;
        bills.bills[parseInt(inp.dataset.billIdx)].plan = inp.value;
        saveS('tango_production_bills', bills);
      });
    }

    // ‚îÄ‚îÄ Ingredients ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    if (ingOnHand && ingNeeded) {
      var ih = '';
      var neededMap = {};
      (ingNeeded.ingredients || []).forEach(function(i) { neededMap[i.item] = i; });
      (ingNeeded.ingredients || []).forEach(function(ing, idx) {
        var onHand = (ingOnHand.ingredients || []).find(function(oh) { return oh.item === ing.item; });
        var haveVal = onHand ? onHand.amount : '?';
        ih += '<tr><td class="col-name">' + ing.item + '</td>';
        ih += '<td><input class="edit-input edit-input--text" type="text" data-ing-idx="' + idx + '" value="' + haveVal + '"></td>';
        ih += '<td class="col-num">' + (ing.need || '‚Äî') + '</td>';
        ih += '<td class="col-num" style="color:#CC0000;font-weight:700;">' + (ing.order || '‚Äî') + '</td></tr>';
      });
      $('brain-ingredients').innerHTML = ih;

      $('brain-ingredients').addEventListener('change', function(e) {
        var inp = e.target;
        if (inp.dataset.ingIdx === undefined) return;
        var idx = parseInt(inp.dataset.ingIdx);
        var item = ingNeeded.ingredients[idx].item;
        var arr = ingOnHand.ingredients || [];
        var found = arr.find(function(i) { return i.item === item; });
        if (found) found.amount = inp.value;
        else arr.push({ item: item, amount: inp.value });
        ingOnHand.ingredients = arr;
        saveS('tango_production_ingredients_on_hand', ingOnHand);
      });
    }

    // ‚îÄ‚îÄ Materials ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    if (materials && materials.materials) {
      var mStatuses = ['Have', 'Low', 'Order', 'OTW'];
      var mStatusColors = { Have:'green', Low:'yellow', Order:'red', OTW:'orange' };
      var mh = '';
      materials.materials.forEach(function(mat, idx) {
        var st = mat.status || 'Have';
        var stColor = mStatusColors[st] || mStatusColors.Have || 'muted';
        mh += '<tr><td class="col-name">' + mat.item + '</td>';
        mh += '<td><span class="status-pill status-pill--' + stColor + ' status-pill--tap" data-mat-idx="' + idx + '">' + st + '</span></td>';
        mh += '<td><input class="edit-input edit-input--text" type="text" data-mat-note-idx="' + idx + '" value="' + (mat.note || '') + '"></td></tr>';
      });
      $('brain-materials').innerHTML = mh;

      $('brain-materials').addEventListener('click', function(e) {
        var pill = e.target.closest('.status-pill--tap[data-mat-idx]');
        if (!pill) return;
        var idx = parseInt(pill.dataset.matIdx);
        var mat = materials.materials[idx];
        var ci = mStatuses.indexOf(mat.status);
        mat.status = mStatuses[(ci + 1) % mStatuses.length];
        var col = mStatusColors[mat.status] || 'muted';
        pill.className = 'status-pill status-pill--' + col + ' status-pill--tap';
        pill.textContent = mat.status;
        saveS('tango_production_materials', materials);
      });
      $('brain-materials').addEventListener('change', function(e) {
        var inp = e.target;
        if (inp.dataset.matNoteIdx === undefined) return;
        materials.materials[parseInt(inp.dataset.matNoteIdx)].note = inp.value;
        saveS('tango_production_materials', materials);
      });
    }

    // ‚îÄ‚îÄ Reference Card ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    var ref = '';
    if (shifts) {
      ref += '<strong>Cook:</strong> ' + (shifts.cook ? shifts.cook.hours + 'hr / $' + shifts.cook.cost : '?') + ' &nbsp;|&nbsp; ';
      ref += '<strong>Pack:</strong> ' + (shifts.pack ? shifts.pack.hours + 'hr / $' + shifts.pack.cost : '?') + '<br>';
    }
    if (conversions) {
      ref += '<strong>1 drum</strong> = ~' + (conversions.drum_to_bottles || 625) + ' bottles &nbsp;|&nbsp; ';
      ref += '<strong>1 case</strong> = ' + (conversions.case_to_bottles || 6) + ' bottles &nbsp;|&nbsp; ';
      ref += '<strong>1 cook shift</strong> = ' + (conversions.cook_shift_ollas || 3) + ' ollas<br>';
    }
    ref += '<strong>Kitchen:</strong> Foodies Urban Kitchen, 8922 Norris Ave, Sun Valley';
    $('brain-reference').innerHTML = ref;
  }

  boot();
})();
</script>

<!-- ============================================================ -->
<!-- üì¶ ORDERS PIPELINE ‚Äî JavaScript (Supabase-backed)             -->
<!-- ============================================================ -->
<script>
(function() {
  // ‚îÄ‚îÄ Supabase config ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  var SUPA_URL = 'https://muowpjabnjkqgwgzfmoj.supabase.co';
  var SUPA_KEY = 'sb_publishable_e-Kx6L_hOKZaG1toGiKidw__weM4n7n';
  var sb = null;
  try { sb = supabase.createClient(SUPA_URL, SUPA_KEY); } catch(e) { console.warn('Supabase unavailable:', e); }

  var STORAGE_KEY = 'tango-orders';

  // ‚îÄ‚îÄ Default orders (seed data) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  var DEFAULT_ORDERS = [
    {
      id: 'exp-12165',
      channel: 'EXP Corp',
      title: 'PO #12165',
      value: '$3,750',
      date_str: 'Pickup: Feb 19',
      stage: 'processing',
      ship_to: 'EXP Warehouse, 28-13 119th St, College Point, NY 11354',
      notes: 'Corrected: Mango $25/case (was $5 typo on PO). Added 20 Sriracha (not on original PO). Mild bottles need cap swap (wrong color caps).',
      items: [
        { sku: 'TH01', flavor: 'Truffle',  cases: 10, price: 50, packed: 0 },
        { sku: 'TH02', flavor: 'Hot',      cases: 50, price: 25, packed: 10 },
        { sku: 'TH03', flavor: 'Mild',     cases: 30, price: 25, packed: 0 },
        { sku: 'TH04', flavor: 'Mango',    cases: 30, price: 25, packed: 0 },
        { sku: 'TH05', flavor: 'Sriracha', cases: 20, price: 25, packed: 0 }
      ],
      checklist: [
        { id: 'c1',  text: 'Swap Mild caps (garage \u2014 wrong color)', done: false, when: 'today' },
        { id: 'c2',  text: 'Haul bottles upstairs (all flavors except Sriracha shortage)', done: false, when: 'today' },
        { id: 'c3',  text: 'Tape bottoms on all 48 boxes', done: false, when: 'today' },
        { id: 'c4',  text: 'Fill + tape + sticker: 30 Mango cases', done: false, when: 'today' },
        { id: 'c5',  text: 'Fill + tape + sticker: 10 Truffle cases', done: false, when: 'today' },
        { id: 'c6',  text: 'Fill + tape + sticker: 8 Sriracha cases (48 bottles = all we have)', done: false, when: 'today' },
        { id: 'c7',  text: 'Get more boxes (need 92 more) \u2014 order or pick up', done: false, when: 'today' },
        { id: 'c8',  text: 'Pack 50 Hot cases (40 new + 10 already done at kitchen)', done: false, when: 'tomorrow' },
        { id: 'c9',  text: 'Pack 30 Mild cases', done: false, when: 'tomorrow' },
        { id: 'c10', text: 'Pack remaining 12 Sriracha cases (need 72 more bottles)', done: false, when: 'tomorrow' },
        { id: 'c11', text: 'Palletize all 140 cases', done: false, when: 'tomorrow' },
        { id: 'c12', text: 'Generate BOL', done: false, when: 'tomorrow' },
        { id: 'c13', text: 'Confirm pickup time with EXP', done: false, when: 'tomorrow' }
      ],
      docs: {
        po:  '/distribution/exp/PO-12165/PO12165 TANGO.pdf',
        bol: '/distribution/exp/PO-12165/BOL-12165.pdf',
        inv: null
      }
    },
    {
      id: 'unfi-044849783',
      channel: 'UNFI Moreno Valley',
      title: 'PO #044849783',
      value: '$3,422',
      date_str: 'Pickup: Feb 9',
      stage: 'shipped',
      docs: {
        po:  '/distribution/unfi/purchase-orders/po-044849783/PO044849783.html',
        bol: '/distribution/unfi/purchase-orders/po-044849783/BOL-044849783.pdf',
        inv: null
      }
    },
    {
      id: 'unfi-1052998',
      channel: 'UNFI Hudson Valley',
      title: 'PO #1052998',
      value: '$3,422',
      date_str: 'Pickup: Feb 25',
      stage: 'processing',
      docs: {
        po:  '/distribution/unfi/purchase-orders/po-1052998/PO1052998.pdf',
        bol: '/distribution/unfi/purchase-orders/po-1052998/BOL-1052998.pdf',
        inv: '/business/UNFI_Invoice_203_PO1052998.md'
      }
    }
  ];

  // ‚îÄ‚îÄ DB helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // Convert DB row (snake_case) ‚Üí app object (camelCase-ish for display)
  function rowToOrder(row) {
    return {
      id: row.id,
      channel: row.channel,
      title: row.title,
      value: row.value,
      date: row.date_str,
      stage: row.stage,
      shipTo: row.ship_to,
      notes: row.notes,
      items: row.items || [],
      checklist: row.checklist || [],
      docs: row.docs || {}
    };
  }

  // Convert app object ‚Üí DB row
  function orderToRow(order) {
    return {
      id: order.id,
      channel: order.channel,
      title: order.title,
      value: order.value,
      date_str: order.date || order.date_str,
      stage: order.stage,
      ship_to: order.shipTo || order.ship_to,
      notes: order.notes,
      items: order.items || [],
      checklist: order.checklist || [],
      docs: order.docs || {},
      updated_at: new Date().toISOString()
    };
  }

  // ‚îÄ‚îÄ Load from Supabase (with localStorage cache) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  var orders = [];

  async function loadOrders() {
    // Try Supabase first
    if (sb) {
      try {
        var res = await sb.from('tango_orders').select('*').order('created_at');
        if (res.data && res.data.length > 0) {
          orders = res.data.map(rowToOrder);
          localStorage.setItem(STORAGE_KEY, JSON.stringify(orders));
          render();
          return;
        }
        // Table empty ‚Äî seed it
        var rows = DEFAULT_ORDERS.map(orderToRow);
        await sb.from('tango_orders').upsert(rows);
        orders = DEFAULT_ORDERS.map(function(d) { return rowToOrder(orderToRow(d)); });
        localStorage.setItem(STORAGE_KEY, JSON.stringify(orders));
        render();
        return;
      } catch(e) {
        console.warn('Supabase load failed, using cache:', e);
      }
    }
    // Fallback to localStorage
    try {
      var raw = localStorage.getItem(STORAGE_KEY);
      orders = raw ? JSON.parse(raw) : DEFAULT_ORDERS.map(function(d) { return rowToOrder(orderToRow(d)); });
    } catch(e) {
      orders = DEFAULT_ORDERS.map(function(d) { return rowToOrder(orderToRow(d)); });
    }
    render();
  }

  // ‚îÄ‚îÄ Save single order ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function saveOrder(order) {
    // Update localStorage cache
    localStorage.setItem(STORAGE_KEY, JSON.stringify(orders));
    // Persist to Supabase (fire and forget)
    if (sb) {
      sb.from('tango_orders').upsert(orderToRow(order)).then(function(res) {
        if (res.error) console.warn('Supabase save error:', res.error);
      });
    }
  }

  // ‚îÄ‚îÄ Render ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function render() {
    var drops = document.querySelectorAll('.pipeline-col__drop');
    drops.forEach(function(d) { d.innerHTML = ''; });

    var stages = { new: 0, processing: 0, shipped: 0, paid: 0 };

    orders.forEach(function(order) {
      stages[order.stage] = (stages[order.stage] || 0) + 1;

      var card = document.createElement('div');
      card.className = 'pipe-card';
      card.draggable = true;
      card.dataset.id = order.id;

      var docsObj = order.docs || {};
      var docsHTML = ['po','bol','inv'].map(function(type) {
        var label = type === 'po' ? 'PO' : type === 'bol' ? 'BOL' : 'Invoice';
        if (docsObj[type]) {
          return '<a class="pipe-card__doc" href="javascript:void(0)" data-doc="' + type + '" data-order="' + order.id + '" title="Export ' + label + '">' + label + '</a>';
        } else {
          return '<span class="pipe-card__doc pipe-card__doc--missing" title="No ' + label + ' yet">' + label + '</span>';
        }
      }).join('');

      card.innerHTML =
        '<div class="pipe-card__channel">' + (order.channel || '') + '</div>' +
        '<div class="pipe-card__title">' + (order.title || '') + '</div>' +
        '<div class="pipe-card__value">' + (order.value || '') + '</div>' +
        '<div class="pipe-card__date">' + (order.date || '') + '</div>' +
        '<div class="pipe-card__docs">' + docsHTML + '</div>';

      var drop = document.querySelector('[data-drop="' + order.stage + '"]');
      if (drop) drop.appendChild(card);
    });

    // Update counts
    document.querySelectorAll('.pipeline-col').forEach(function(col) {
      var stage = col.dataset.stage;
      var countEl = col.querySelector('[data-count]');
      if (countEl) countEl.textContent = stages[stage] || 0;
    });
  }

  // ‚îÄ‚îÄ Drag & Drop ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  var dragId = null;

  document.getElementById('orders-pipeline').addEventListener('dragstart', function(e) {
    var card = e.target.closest('.pipe-card');
    if (!card) return;
    dragId = card.dataset.id;
    card.classList.add('dragging');
    e.dataTransfer.effectAllowed = 'move';
  });

  document.getElementById('orders-pipeline').addEventListener('dragend', function(e) {
    var card = e.target.closest('.pipe-card');
    if (card) card.classList.remove('dragging');
    document.querySelectorAll('.drag-over').forEach(function(el) { el.classList.remove('drag-over'); });
    dragId = null;
  });

  document.querySelectorAll('.pipeline-col__drop').forEach(function(drop) {
    drop.addEventListener('dragover', function(e) {
      e.preventDefault();
      e.dataTransfer.dropEffect = 'move';
      drop.classList.add('drag-over');
    });
    drop.addEventListener('dragleave', function() {
      drop.classList.remove('drag-over');
    });
    drop.addEventListener('drop', function(e) {
      e.preventDefault();
      drop.classList.remove('drag-over');
      if (!dragId) return;
      var newStage = drop.dataset.drop;
      var order = orders.find(function(o) { return o.id === dragId; });
      if (order && order.stage !== newStage) {
        order.stage = newStage;
        saveOrder(order);
        render();
      }
    });
  });

  // ‚îÄ‚îÄ Document export (open file) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function showToast(msg) {
    var toast = document.createElement('div');
    toast.textContent = msg;
    toast.style.cssText = 'position:fixed;bottom:24px;left:50%;transform:translateX(-50%);background:#222;color:#fff;padding:12px 24px;border-radius:12px;font-size:13px;z-index:9999;box-shadow:0 4px 24px rgba(0,0,0,.4);opacity:0;transition:opacity .2s';
    document.body.appendChild(toast);
    requestAnimationFrame(function() { toast.style.opacity = '1'; });
    setTimeout(function() {
      toast.style.opacity = '0';
      setTimeout(function() { toast.remove(); }, 300);
    }, 2500);
  }

  document.getElementById('orders-pipeline').addEventListener('click', function(e) {
    var docBtn = e.target.closest('.pipe-card__doc[data-doc]');
    if (!docBtn) return;
    e.preventDefault();
    e.stopPropagation();
    var orderId = docBtn.dataset.order;
    var docType = docBtn.dataset.doc;
    var order = orders.find(function(o) { return o.id === orderId; });
    if (!order || !order.docs[docType]) return;

    var fullPath = '/Projects/\uD83D\uDD25 tango' + order.docs[docType];

    navigator.clipboard.writeText(fullPath).then(function() {
      showToast('\uD83D\uDCCB Copied: ' + fullPath.split('/').pop());
    }).catch(function() {
      prompt('Document path:', fullPath);
    });
  });

  // ‚îÄ‚îÄ Click card to open order detail ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  var clickStartX, clickStartY;
  document.getElementById('orders-pipeline').addEventListener('mousedown', function(e) {
    clickStartX = e.clientX;
    clickStartY = e.clientY;
  });
  document.getElementById('orders-pipeline').addEventListener('click', function(e) {
    if (Math.abs(e.clientX - clickStartX) > 5 || Math.abs(e.clientY - clickStartY) > 5) return;
    if (e.target.closest('.pipe-card__doc')) return;
    var card = e.target.closest('.pipe-card');
    if (!card) return;
    window.location.href = 'order.html?id=' + card.dataset.id;
  });

  // ‚îÄ‚îÄ Touch support for mobile drag ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  var touchCard = null;
  var touchClone = null;
  var touchStartX, touchStartY;

  document.getElementById('orders-pipeline').addEventListener('touchstart', function(e) {
    var card = e.target.closest('.pipe-card');
    if (!card || e.target.closest('.pipe-card__doc')) return;
    touchCard = card;
    dragId = card.dataset.id;
    var rect = card.getBoundingClientRect();
    touchStartX = e.touches[0].clientX - rect.left;
    touchStartY = e.touches[0].clientY - rect.top;

    touchClone = card.cloneNode(true);
    touchClone.style.position = 'fixed';
    touchClone.style.width = rect.width + 'px';
    touchClone.style.opacity = '0.85';
    touchClone.style.zIndex = '9999';
    touchClone.style.pointerEvents = 'none';
    touchClone.style.transform = 'scale(1.04)';
    touchClone.style.boxShadow = '0 12px 40px rgba(0,0,0,0.3)';
    document.body.appendChild(touchClone);

    card.classList.add('dragging');
  }, { passive: true });

  document.addEventListener('touchmove', function(e) {
    if (!touchClone) return;
    var x = e.touches[0].clientX - touchStartX;
    var y = e.touches[0].clientY - touchStartY;
    touchClone.style.left = x + 'px';
    touchClone.style.top = y + 'px';

    document.querySelectorAll('.drag-over').forEach(function(el) { el.classList.remove('drag-over'); });
    var el = document.elementFromPoint(e.touches[0].clientX, e.touches[0].clientY);
    if (el) {
      var drop = el.closest('.pipeline-col__drop');
      if (drop) drop.classList.add('drag-over');
    }
  }, { passive: true });

  document.addEventListener('touchend', function(e) {
    if (!touchClone) return;
    document.querySelectorAll('.drag-over').forEach(function(el) { el.classList.remove('drag-over'); });

    var touch = e.changedTouches[0];
    touchClone.style.display = 'none';
    var el = document.elementFromPoint(touch.clientX, touch.clientY);
    touchClone.style.display = '';
    if (el) {
      var drop = el.closest('.pipeline-col__drop');
      if (drop && dragId) {
        var newStage = drop.dataset.drop;
        var order = orders.find(function(o) { return o.id === dragId; });
        if (order && order.stage !== newStage) {
          order.stage = newStage;
          saveOrder(order);
        }
      }
    }

    if (touchCard) touchCard.classList.remove('dragging');
    if (touchClone && touchClone.parentNode) touchClone.parentNode.removeChild(touchClone);
    touchCard = null;
    touchClone = null;
    dragId = null;
    render();
  });

  // ‚îÄ‚îÄ Boot ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // Render cached/defaults immediately so page is never blank
  try {
    var raw = localStorage.getItem(STORAGE_KEY);
    orders = raw ? JSON.parse(raw) : DEFAULT_ORDERS.map(function(d) { return rowToOrder(orderToRow(d)); });
  } catch(e) {
    orders = DEFAULT_ORDERS.map(function(d) { return rowToOrder(orderToRow(d)); });
  }
  render();
  // Then sync from Supabase in background
  loadOrders();
})();
</script>


<!-- Service Worker Registration -->
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./sw.js').then(function(reg) {
    reg.update();
  });
}
</script>

</body>
</html>
